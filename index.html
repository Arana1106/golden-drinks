<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SINNER'S</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== ESTILOS SINNER'S - √ÅNGELES vs DEMONIOS ===== */
        @import url('https://fonts.googleapis.com/css2?family=Nosifer&family=Eater&family=Cinzel:wght@400;700&family=MedievalSharp&display=swap');

</head>
<body class="tema-demonios">
    <!-- Alerta de pedido m√≠nimo (oculta por defecto) -->
    <div class="alerta-minimo" id="alerta-minimo">
        <div>
            <strong>PEDIDO M√çNIMO</strong>
            <p>No aceptamos pedidos con menos de 3 productos. Agrega m√°s items para continuar.</p>
        </div>
        <button class="cerrar-alerta" id="cerrar-alerta">&times;</button>
    </div>

<!-- JavaScript -->

<script>
    // Datos de productos con toppings corregidos
    const productos = {
        bebidas: [
            { 
                id: 1, 
                nombre: "LEVIAT√ÅN", 
                descripcion: "Sum√©rgete en las profundidades de la tentaci√≥n azul oscura. Sabor a mora azul que te arrastrar√° al abismo. 475ml",
                sabor: "Mora azul", 
                precio: 50, 
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                    { nombre: "Elixir Prohibido (Alcohol 2.5 oz)", precio: 15 }
                ]
            },
            { 
                id: 2, 
                nombre: "INFIERNO", 
                descripcion: "Pasi√≥n ardiente con sabor a frutos rojos 475ml",
                sabor: "Frutos rojos", 
                precio: 50, 
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                    { nombre: "Elixir Prohibido (Alcohol 2.5 oz)", precio: 15 }
                ]
            },
            { 
                id: 3, 
                nombre: "JALURIA", 
                descripcion: "Entre m√°s lo resistes m√°s deseas probar su sabor a manzana verde con jengibre 475ml",
                sabor: "Manzana verde", 
                precio: 50, 
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                    { nombre: "Elixir Prohibido (Alcohol 2.5 oz)", precio: 15 }
                ]
            },
            { 
                id: 4, 
                nombre: "ASMODEO", 
                descripcion: "Te har√° sentir la lujuria en un sorbo por su sabor a frutos del bosque 475ml",
                sabor: "Frutos del bosque", 
                precio: 50, 
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 },
                    { nombre: "Elixir Prohibido (Alcohol 2.5 oz)", precio: 15 }
                ]
            }
        ],
        cafes: [
            { 
                id: 5, 
                nombre: "IRA DIVINA", 
                descripcion: "Energ√≠a Divina toma un caf√© deconstruido fr√≠o 475ml",
                sabor: "Caf√© deconstruido", 
                precio: 40, 
                opciones: {
                    "LECHE": ["Normal", "Deslactosada (+$10)"],
                    "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
                },
                toppings: [
                    { nombre: "Gemas del Infierno (Coffee Jelly)", precio: 15 }
                ]
            },
            { 
                id: 6, 
                nombre: "PACTUM", 
                descripcion: "Pacto con the devil, tranquilo solo es un suave caf√© descafeinado 475ml",
                sabor: "Caf√© descafeinado", 
                precio: 40, 
                opciones: {
                    "LECHE": ["Normal", "Deslactosada (+$10)"],
                    "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
                },
                toppings: [
                    { nombre: "Gemas del Infierno (Coffee Jelly)", precio: 15 }
                ]
            }
        ],
        tes: [
            { 
                id: 7, 
                nombre: "REDENCI√ìN", 
                descripcion: "Todos la buscamos, y todos la necesitamos su sabor Negro, o Verde y m√°s en sus 475 ml (pregunta por la disponibilidad de los sabores)",
                sabor: "Pregunta por la selecci√≥n", 
                precio: 35, 
                opciones: {
                    "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
                },
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 }
                ]
            },
            { 
                id: 8, 
                nombre: "REVELACI√ìN", 
                descripcion: "El misterio se devela hoy. ¬øSer√° tu salvaci√≥n o tu perdici√≥n? Atr√©vete a conocer el veredicto. Bebida del d√≠a 475ml",
                sabor: "Bebida del d√≠a", 
                precio: 35, 
                opciones: {
                    "ENDULZANTE": ["Az√∫car", "Sustituto", "Sin endulzante"]
                },
                toppings: [
                    { nombre: "L√°grimas de Demonio (Bubble Jelly)", precio: 15 }
                ]
            }
        ]
    };

    // Datos de combos
    const combos = {
        demonios: {
            nombre: "TRINIDAD DEL INFIERNO",
            productos: ["INFIERNO", "ASMODEO", "REVELACI√ìN"],
            precioBase: 120,
            descripcion: "INFERNO + ASMODEO + REVELACI√ìN"
        },
        angeles: {
            nombre: "SANT√çSIMA TRINIDAD",
            productos: ["LEVIAT√ÅN", "JALURIA", "REDENCI√ìN"],
            precioBase: 120,
            descripcion: "LEVIAT√ÅN + JALURIA + REDENCI√ìN"
        }
    };

    // Variables globales
    let carrito = [];
    let productoSeleccionado = null;
    let opcionesSeleccionadas = {};
    let comboSeleccionado = null;
    let opcionesComboSeleccionadas = {};
    let direccionSeleccionada = "";

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
        cargarProductos();
        cargarCarritoDesdeLocalStorage();
        actualizarCarrito();
        configurarEventos();
        configurarPanelAdmin();
    });

    // Configurar eventos
    function configurarEventos() {
        // Cambio de tema con doble clic
        document.getElementById('titulo-tema').addEventListener('dblclick', cambiarTema);
        
        // Bot√≥n carrito
        document.getElementById('carrito-btn').addEventListener('click', abrirModalCarrito);
        
        // Cerrar modales
        document.getElementById('cerrar-opciones').addEventListener('click', cerrarModalOpciones);
        document.getElementById('cerrar-carrito').addEventListener('click', cerrarModalCarrito);
        document.getElementById('cerrar-ubicacion').addEventListener('click', cerrarModalUbicacion);
        document.getElementById('cerrar-combo').addEventListener('click', cerrarModalCombo);
        document.getElementById('cerrar-pago').addEventListener('click', cerrarModalPago);
        document.getElementById('cerrar-alerta').addEventListener('click', function() {
            document.getElementById('alerta-minimo').style.display = 'none';
        });
        
        // Botones de modales
        document.getElementById('regresar-modal').addEventListener('click', cerrarModalOpciones);
        document.getElementById('confirmar-opciones').addEventListener('click', confirmarSeleccion);
        document.getElementById('seguir-pidiendo').addEventListener('click', cerrarModalCarrito);
        document.getElementById('whatsapp-btn').addEventListener('click', mostrarSeleccionUbicacion);
        document.getElementById('regresar-carrito').addEventListener('click', cerrarModalUbicacion);
                    document.getElementById('confirmar-ubicacion').addEventListener('click', mostrarInstruccionesPago);
            document.getElementById('regresar-combo').addEventListener('click', cerrarModalCombo);
            document.getElementById('confirmar-combo').addEventListener('click', confirmarCombo);
            document.getElementById('abrir-maps').addEventListener('click', abrirGoogleMaps);
            document.getElementById('regresar-direccion').addEventListener('click', regresarADireccion);
            document.getElementById('confirmar-pedido').addEventListener('click', enviarPedidoWhatsApp);
            
            // Cerrar modales al hacer clic fuera
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('modal-oculto');
                    }
                });
            });

            // Acceso al panel administrativo con Ctrl+Alt+A
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.altKey && e.key === 'a') {
                    e.preventDefault();
                    document.getElementById('admin-panel').style.display = 'block';
                }
            });

            // Eventos del panel administrativo
            document.getElementById('cerrar-admin').addEventListener('click', function() {
                document.getElementById('admin-panel').style.display = 'none';
            });
            document.getElementById('guardar-cambios').addEventListener('click', guardarCambiosAdmin);
        }

        // Cargar productos en la interfaz
        function cargarProductos() {
            for (const categoria in productos) {
                const contenedor = document.getElementById(`${categoria}-container`);
                if (contenedor) {
                    productos[categoria].forEach(producto => {
                        const elementoProducto = crearElementoProducto(producto);
                        contenedor.appendChild(elementoProducto);
                    });
                }
            }
        }

        // Crear elemento de producto
        function crearElementoProducto(producto) {
            const div = document.createElement('div');
            div.className = 'producto-card';
            div.innerHTML = `
                <h3 data-producto="${producto.nombre}">${producto.nombre}</h3>
                <p>${producto.descripcion}</p>
                <p class="precio">$${producto.precio}.00 MXN</p>
                <button class="btn-seleccionar">SELECCIONAR PECADO</button>
            `;
            
            // Asignar evento al bot√≥n
            const boton = div.querySelector('.btn-seleccionar');
            boton.addEventListener('click', () => seleccionarProducto(producto));
            
            return div;
        }

        // Seleccionar producto para personalizar
        function seleccionarProducto(producto) {
            productoSeleccionado = producto;
            opcionesSeleccionadas = {};
            mostrarModalOpciones();
        }

        // Mostrar modal de opciones (MODIFICADA)
        function mostrarModalOpciones() {
            const modal = document.getElementById('modal-opciones');
            const tituloModal = document.getElementById('titulo-modal');
            const saborDestacado = document.getElementById('sabor-destacado');
            const formulario = document.getElementById('formulario-opciones');
            
            tituloModal.textContent = `Personalizar ${productoSeleccionado.nombre}`;
            saborDestacado.textContent = `Sabor: ${productoSeleccionado.sabor}`;
            formulario.innerHTML = '';
            
            // Crear opciones personalizables (para caf√©s y t√©s)
            if (productoSeleccionado.opciones) {
                for (const [opcion, valores] of Object.entries(productoSeleccionado.opciones)) {
                    const opcionGroup = document.createElement('div');
                    opcionGroup.className = 'opcion-group';
                    opcionGroup.innerHTML = `<h3>${opcion}</h3>`;
                    
                    valores.forEach((valor, index) => {
                        const inputId = `opcion-${opcion}-${index}`;
                        
                        const div = document.createElement('div');
                        div.className = 'topping-checkbox';
                        
                        const radio = document.createElement('input');
                        radio.type = 'radio';
                        radio.name = opcion;
                        radio.value = valor;
                        radio.id = inputId;
                        radio.checked = index === 0;
                        
                        radio.addEventListener('change', function() {
                            opcionesSeleccionadas[opcion] = valor;
                        });
                        
                        const label = document.createElement('label');
                        label.htmlFor = inputId;
                        label.textContent = valor.replace('(+$10)', '').trim();
                        
                        // Mostrar precio si existe
                        if (valor.includes('+$10')) {
                            const priceSpan = document.createElement('span');
                            priceSpan.className = 'topping-price';
                            priceSpan.textContent = '+$10';
                            label.appendChild(priceSpan);
                        }
                        
                        div.appendChild(radio);
                        div.appendChild(label);
                        opcionGroup.appendChild(div);
                    });
                    
                    formulario.appendChild(opcionGroup);
                    // Establecer valor por defecto
                    opcionesSeleccionadas[opcion] = valores[0].replace('(+$10)', '').trim();
                }
            }
            
            // Crear checkboxes para toppings (para todas las bebidas)
            if (productoSeleccionado.toppings && productoSeleccionado.toppings.length > 0) {
                const toppingsGroup = document.createElement('div');
                toppingsGroup.className = 'opcion-group';
                toppingsGroup.innerHTML = `<h3>TOPPINGS</h3>`;
                
                // Opci√≥n sin topping
                const sinToppingDiv = document.createElement('div');
                sinToppingDiv.className = 'topping-checkbox';
                
                const radioSin = document.createElement('input');
                radioSin.type = 'radio';
                radioSin.name = 'topping';
                radioSin.value = 'sin';
                radioSin.id = 'topping-sin';
                radioSin.checked = true;
                
                radioSin.addEventListener('change', function() {
                    if (this.checked) {
                        // Desmarcar todos los checkboxes de toppings
                        document.querySelectorAll('input[type="checkbox"][name="toppings"]').forEach(cb => {
                            cb.checked = false;
                        });
                        opcionesSeleccionadas.toppings = [];
                    }
                });
                
                const labelSin = document.createElement('label');
                labelSin.htmlFor = 'topping-sin';
                labelSin.textContent = 'Sin topping';
                
                sinToppingDiv.appendChild(radioSin);
                sinToppingDiv.appendChild(labelSin);
                toppingsGroup.appendChild(sinToppingDiv);
                
                // Opciones de toppings
                productoSeleccionado.toppings.forEach((topping, index) => {
                    const toppingDiv = document.createElement('div');
                    toppingDiv.className = 'topping-checkbox';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'toppings';
                    checkbox.value = topping.nombre;
                    checkbox.id = `topping-${index}`;
                    
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            // Desmarcar "Sin topping"
                            document.getElementById('topping-sin').checked = false;
                            
                            // Agregar topping a las opciones seleccionadas
                            if (!opcionesSeleccionadas.toppings) {
                                opcionesSeleccionadas.toppings = [];
                            }
                            opcionesSeleccionadas.toppings.push(topping.nombre);
                        } else {
                            // Remover topping de las opciones seleccionadas
                            if (opcionesSeleccionadas.toppings) {
                                const index = opcionesSeleccionadas.toppings.indexOf(topping.nombre);
                                if (index > -1) {
                                    opcionesSeleccionadas.toppings.splice(index, 1);
                                }
                                
                                // Si no hay toppings seleccionados, marcar "Sin topping"
                                if (opcionesSeleccionadas.toppings.length === 0) {
                                    document.getElementById('topping-sin').checked = true;
                                }
                            }
                        }
                    });
                    
                    const label = document.createElement('label');
                    label.htmlFor = `topping-${index}`;
                    
                    const toppingInfo = document.createElement('div');
                    toppingInfo.className = 'topping-info';
                    
                    const toppingName = document.createElement('span');
                    toppingName.className = 'topping-name';
                    toppingName.textContent = topping.nombre;
                    
                    const toppingPrice = document.createElement('span');
                    toppingPrice.className = 'topping-price';
                    toppingPrice.textContent = `+$${topping.precio}`;
                    
                    toppingInfo.appendChild(toppingName);
                    toppingInfo.appendChild(toppingPrice);
                    label.appendChild(toppingInfo);
                    
                    toppingDiv.appendChild(checkbox);
                    toppingDiv.appendChild(label);
                    toppingsGroup.appendChild(toppingDiv);
                });
                
                formulario.appendChild(toppingsGroup);
                // Establecer valor por defecto
                opcionesSeleccionadas.toppings = [];
            }
            
            modal.classList.remove('modal-oculto');
        }

        // Cerrar modal de opciones
        function cerrarModalOpciones() {
            document.getElementById('modal-opciones').classList.add('modal-oculto');
        }

        // Confirmar selecci√≥n y agregar al carrito (MODIFICADA)
        function confirmarSeleccion() {
            // Calcular precio adicional por opciones
            let precioAdicional = 0;
            let detallesVariables = [];
            
            // Procesar opciones de caf√©s y t√©s
            for (const [opcion, valor] of Object.entries(opcionesSeleccionadas)) {
                if (opcion !== 'toppings') {
                    if (valor.includes('Deslactosada')) precioAdicional += 10;
                    
                    // Guardar detalles para mostrar en carrito
                    if (valor.includes('Deslactosada')) {
                        detallesVariables.push(`${opcion}: ${valor}`);
                    }
                }
            }
            
            // Procesar toppings
            if (opcionesSeleccionadas.toppings && opcionesSeleccionadas.toppings.length > 0) {
                opcionesSeleccionadas.toppings.forEach(toppingNombre => {
                    // Encontrar el topping para obtener su precio
                    const topping = productoSeleccionado.toppings.find(t => t.nombre === toppingNombre);
                    if (topping) {
                        precioAdicional += topping.precio;
                        detallesVariables.push(`Topping: ${topping.nombre}`);
                    }
                });
            }
            
            const precioTotal = productoSeleccionado.precio + precioAdicional;
            
            const itemCarrito = {
                ...productoSeleccionado,
                opciones: {...opcionesSeleccionadas},
                cantidad: 1,
                precioTotal: precioTotal,
                detallesVariables: detallesVariables
            };
            
            // Verificar si ya existe en el carrito
            const indexExistente = carrito.findIndex(item => 
                item.id === itemCarrito.id && 
                JSON.stringify(item.opciones) === JSON.stringify(itemCarrito.opciones)
            );
            
            if (indexExistente !== -1) {
                carrito[indexExistente].cantidad++;
                carrito[indexExistente].precioTotal += precioTotal;
            } else {
                carrito.push(itemCarrito);
            }
            
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            cerrarModalOpciones();
            
            // Efecto visual de confirmaci√≥n
            const carritoBtn = document.getElementById('carrito-btn');
            carritoBtn.classList.add('pulse-effect');
            setTimeout(() => {
                carritoBtn.classList.remove('pulse-effect');
            }, 500);
        }

        // Guardar carrito en localStorage
        function guardarCarritoEnLocalStorage() {
            localStorage.setItem('sinnerCart', JSON.stringify(carrito));
        }

        // Cargar carrito desde localStorage
        function cargarCarritoDesdeLocalStorage() {
            const carritoGuardado = localStorage.getItem('sinnerCart');
            if (carritoGuardado) {
                carrito = JSON.parse(carritoGuardado);
            }
        }

        // Actualizar carrito
        function actualizarCarrito() {
            const contador = document.getElementById('contador');
            contador.textContent = carrito.reduce((total, item) => total + item.cantidad, 0);
        }

        // Abrir modal de carrito
        function abrirModalCarrito() {
            const modal = document.getElementById('modal-carrito');
            const listaCarrito = document.getElementById('lista-carrito');
            const totalCarrito = document.getElementById('total-carrito');
            
            listaCarrito.innerHTML = '';
            
            if (carrito.length === 0) {
                listaCarrito.innerHTML = '<p class="carrito-vacio">Tu carrito est√° vac√≠o</p>';
                totalCarrito.textContent = 'Total: $0.00 MXN';
            } else {
                let total = 0;
                
                carrito.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'item-carrito';
                    
                    let detallesHTML = '';
                    if (item.detallesVariables && item.detallesVariables.length > 0) {
                        detallesHTML = `<div class="detalles-variables">`;
                        item.detallesVariables.forEach(detalle => {
                            detallesHTML += `<div>${detalle}</div>`;
                        });
                        detallesHTML += `</div>`;
                    }
                    
                    itemElement.innerHTML = `
                        <div class="item-info">
                            <h4>${item.nombre}</h4>
                            ${detallesHTML}
                            <p class="precio-item">$${item.precioTotal}.00 MXN</p>
                        </div>
                        <div class="item-controles">
                            <button onclick="modificarCantidad(${index}, -1)">-</button>
                            <span>${item.cantidad}</span>
                            <button onclick="modificarCantidad(${index}, 1)">+</button>
                            <button onclick="eliminarItem(${index})">üóëÔ∏è</button>
                        </div>
                    `;
                    listaCarrito.appendChild(itemElement);
                    total += item.precioTotal;
                });
                
                totalCarrito.textContent = `Total: $${total}.00 MXN`;
            }
            
            modal.classList.remove('modal-oculto');
        }

        // Cerrar modal de carrito
        function cerrarModalCarrito() {
            document.getElementById('modal-carrito').classList.add('modal-oculto');
        }

        // Modificar cantidad de items en carrito
        function modificarCantidad(index, cambio) {
            const item = carrito[index];
            const precioUnitario = item.precioTotal / item.cantidad;
            
            if (cambio === 1) {
                item.cantidad++;
                item.precioTotal += precioUnitario;
            } else if (cambio === -1 && item.cantidad > 1) {
                item.cantidad--;
                item.precioTotal -= precioUnitario;
            }
            
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            abrirModalCarrito(); // Refrescar vista
        }

        // Eliminar item del carrito
        function eliminarItem(index) {
            carrito.splice(index, 1);
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            
            if (carrito.length === 0) {
                cerrarModalCarrito();
            } else {
                abrirModalCarrito(); // Refrescar vista
            }
        }

        // Cambiar entre temas
        function cambiarTema() {
            const body = document.body;
            
            if (body.classList.contains('tema-demonios')) {
                body.classList.remove('tema-demonios');
                body.classList.add('tema-angeles');
                document.getElementById('combos-demonios').style.display = 'none';
                document.getElementById('combos-angeles').style.display = 'block';
            } else {
                body.classList.remove('tema-angeles');
                body.classList.add('tema-demonios');
                document.getElementById('combos-demonios').style.display = 'block';
                document.getElementById('combos-angeles').style.display = 'none';
            }
        }

        // Seleccionar combo
        function seleccionarCombo(tipo) {
            comboSeleccionado = combos[tipo];
            opcionesComboSeleccionadas = {};
            mostrarModalCombo();
        }

        // Mostrar modal de combo
        function mostrarModalCombo() {
            const modal = document.getElementById('modal-combo');
            const tituloCombo = document.getElementById('titulo-combo');
            const opcionesCombo = document.getElementById('opciones-combo');
            
            tituloCombo.textContent = `Personalizar ${comboSeleccionado.nombre}`;
            opcionesCombo.innerHTML = '';
            
            // Crear opciones para cada producto del combo
            comboSeleccionado.productos.forEach(nombreProducto => {
                // Buscar el producto en los datos
                let producto = null;
                for (const categoria in productos) {
                    producto = productos[categoria].find(p => p.nombre === nombreProducto);
                    if (producto) break;
                }
                
                if (producto) {
                    const productoGroup = document.createElement('div');
                    productoGroup.className = 'opcion-group';
                    productoGroup.innerHTML = `<h3>${producto.nombre} (${producto.sabor})</h3>`;
                    
                    // Mostrar opciones para caf√©s y t√©s
                    if (producto.opciones) {
                        for (const [opcion, valores] of Object.entries(producto.opciones)) {
                            valores.forEach((valor, index) => {
                                const inputId = `combo-${producto.nombre}-${opcion}-${index}`;
                                
                                const div = document.createElement('div');
                                div.className = 'topping-checkbox';
                                
                                const radio = document.createElement('input');
                                radio.type = 'radio';
                                radio.name = `${producto.nombre}-${opcion}`;
                                radio.value = valor;
                                radio.id = inputId;
                                radio.checked = index === 0;
                                
                                radio.addEventListener('change', function() {
                                    if (!opcionesComboSeleccionadas[producto.nombre]) {
                                        opcionesComboSeleccionadas[producto.nombre] = {};
                                    }
                                    opcionesComboSeleccionadas[producto.nombre][opcion] = valor;
                                });
                                
                                const label = document.createElement('label');
                                label.htmlFor = inputId;
                                label.textContent = valor.replace('(+$10)', '').trim();
                                
                                // Mostrar precio si existe
                                if (valor.includes('+$10')) {
                                    const priceSpan = document.createElement('span');
                                    priceSpan.className = 'topping-price';
                                    priceSpan.textContent = '+$10';
                                    label.appendChild(priceSpan);
                                }
                                
                                div.appendChild(radio);
                                div.appendChild(label);
                                productoGroup.appendChild(div);
                            });
                            
                            // Establecer valor por defecto
                            if (!opcionesComboSeleccionadas[producto.nombre]) {
                                opcionesComboSeleccionadas[producto.nombre] = {};
                            }
                            opcionesComboSeleccionadas[producto.nombre][opcion] = valores[0].replace('(+$10)', '').trim();
                        }
                    }
                    
                    // Mostrar toppings para todos los productos
                    if (producto.toppings && producto.toppings.length > 0) {
                        const toppingsTitle = document.createElement('h4');
                        toppingsTitle.textContent = 'Toppings:';
                        toppingsTitle.style.marginTop = '10px';
                        toppingsTitle.style.color = '#ffd700';
                        productoGroup.appendChild(toppingsTitle);
                        
                        producto.toppings.forEach((topping, toppingIndex) => {
                            const toppingDiv = document.createElement('div');
                            toppingDiv.className = 'topping-checkbox';
                            
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.name = `${producto.nombre}-toppings`;
                            checkbox.value = topping.nombre;
                            checkbox.id = `combo-${producto.nombre}-topping-${toppingIndex}`;
                            
                            checkbox.addEventListener('change', function() {
                                if (!opcionesComboSeleccionadas[producto.nombre]) {
                                    opcionesComboSeleccionadas[producto.nombre] = {};
                                }
                                if (!opcionesComboSeleccionadas[producto.nombre].toppings) {
                                    opcionesComboSeleccionadas[producto.nombre].toppings = [];
                                }
                                
                                if (this.checked) {
                                    opcionesComboSeleccionadas[producto.nombre].toppings.push(topping.nombre);
                                } else {
                                    const index = opcionesComboSeleccionadas[producto.nombre].toppings.indexOf(topping.nombre);
                                    if (index > -1) {
                                        opcionesComboSeleccionadas[producto.nombre].toppings.splice(index, 1);
                                    }
                                }
                            });
                            
                            const label = document.createElement('label');
                            label.htmlFor = `combo-${producto.nombre}-topping-${toppingIndex}`;
                            
                            const toppingInfo = document.createElement('div');
                            toppingInfo.className = 'topping-info';
                            
                            const toppingName = document.createElement('span');
                            toppingName.className = 'topping-name';
                            toppingName.textContent = topping.nombre;
                            
                            const toppingPrice = document.createElement('span');
                            toppingPrice.className = 'topping-price';
                            toppingPrice.textContent = `+$${topping.precio}`;
                            
                            toppingInfo.appendChild(toppingName);
                            toppingInfo.appendChild(toppingPrice);
                            label.appendChild(toppingInfo);
                            
                            toppingDiv.appendChild(checkbox);
                            toppingDiv.appendChild(label);
                            productoGroup.appendChild(toppingDiv);
                        });
                    }
                    
                    opcionesCombo.appendChild(productoGroup);
                }
            });
            
            modal.classList.remove('modal-oculto');
        }

        // Cerrar modal de combo
        function cerrarModalCombo() {
            document.getElementById('modal-combo').classList.add('modal-oculto');
        }

        // Confirmar combo y agregar al carrito
        function confirmarCombo() {
            // Calcular precio adicional por opciones
            let precioAdicional = 0;
            let detallesCombo = [];
            
            for (const [nombreProducto, opciones] of Object.entries(opcionesComboSeleccionadas)) {
                // Procesar opciones regulares
                for (const [opcion, valor] of Object.entries(opciones)) {
                    if (opcion !== 'toppings') {
                        if (valor.includes('Deslactosada')) precioAdicional += 10;
                        
                        // Guardar detalles para mostrar en carrito
                        if (valor.includes('Deslactosada')) {
                            detallesCombo.push(`${nombreProducto}: ${valor}`);
                        }
                    }
                }
                
                // Procesar toppings
                if (opciones.toppings && opciones.toppings.length > 0) {
                    opciones.toppings.forEach(toppingNombre => {
                        // Buscar el producto para encontrar el topping
                        let producto = null;
                        for (const categoria in productos) {
                            producto = productos[categoria].find(p => p.nombre === nombreProducto);
                            if (producto) break;
                        }
                        
                        if (producto && producto.toppings) {
                            const topping = producto.toppings.find(t => t.nombre === toppingNombre);
                            if (topping) {
                                precioAdicional += topping.precio;
                                detallesCombo.push(`${nombreProducto}: ${topping.nombre}`);
                            }
                        }
                    });
                }
            }
            
            const precioTotal = comboSeleccionado.precioBase + precioAdicional;
            
            const itemCarrito = {
                id: `combo-${comboSeleccionado.nombre}`,
                nombre: comboSeleccionado.nombre,
                descripcion: comboSeleccionado.descripcion,
                opciones: {...opcionesComboSeleccionadas},
                cantidad: 1,
                precioTotal: precioTotal,
                detallesVariables: detallesCombo,
                esCombo: true,
                cuentaComoTres: true // Marcar que cuenta como 3 productos
            };
            
            carrito.push(itemCarrito);
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            cerrarModalCombo();
            
            // Efecto visual de confirmaci√≥n
            const carritoBtn = document.getElementById('carrito-btn');
            carritoBtn.classList.add('pulse-effect');
            setTimeout(() => {
                carritoBtn.classList.remove('pulse-effect');
            }, 500);
        }

        // Funciones para los modales de ubicaci√≥n
        function mostrarSeleccionUbicacion() {
            if (carrito.length === 0) {
                alert('Agrega al menos un producto al carrito primero');
                return;
            }
            
            // Verificar pedido m√≠nimo de 3 productos
            const totalProductos = carrito.reduce((total, item) => total + (item.cuentaComoTres ? 3 : item.cantidad), 0);
            if (totalProductos < 3) {
                alert('PEDIDO M√çNIMO: Debes agregar al menos 3 productos para realizar tu pedido.');
                document.getElementById('alerta-minimo').style.display = 'flex';
                return;
            }
            
            document.getElementById('modal-carrito').classList.add('modal-oculto');
            document.getElementById('modal-ubicacion').classList.remove('modal-oculto');
            
            // Establecer direcci√≥n por defecto
            direccionSeleccionada = "Calle Coral 120, colonia Estrella, CDMX";
        }

        function cerrarModalUbicacion() {
            document.getElementById('modal-ubicacion').classList.add('modal-oculto');
        }

        function abrirGoogleMaps() {
            const address = "Calle Coral 120, colonia Estrella, CDMX";
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(address)}`, '_blank');
        }

        function mostrarInstruccionesPago() {
            document.getElementById('modal-ubicacion').classList.add('modal-oculto');
            
            // Mostrar la direcci√≥n seleccionada en el modal de pago
            document.getElementById('direccion-confirmacion').textContent = `üìç ${direccionSeleccionada}`;
            
            document.getElementById('modal-pago').classList.remove('modal-oculto');
        }

        function cerrarModalPago() {
            document.getElementById('modal-pago').classList.add('modal-oculto');
        }

        function regresarADireccion() {
            document.getElementById('modal-pago').classList.add('modal-oculto');
            document.getElementById('modal-ubicacion').style.display = 'flex';
        }

        function enviarPedidoWhatsApp() {
            if (carrito.length === 0) {
                alert('No hay items en el carrito');
                return;
            }
            
            // Verificar pedido m√≠nimo de 3 productos
            const totalProductos = carrito.reduce((total, item) => total + (item.cuentaComoTres ? 3 : item.cantidad), 0);
            if (totalProductos < 3) {
                alert('PEDIDO M√çNIMO: Debes agregar al menos 3 productos para realizar tu pedido.');
                document.getElementById('alerta-minimo').style.display = 'flex';
                return;
            }
            
            let mensaje = "¬°Hola! Quiero realizar el siguiente pedido:%0A%0A";
            
            carrito.forEach(item => {
                if (item.esCombo) {
                    // Formato para combos
                    mensaje += `- COMBO: ${item.nombre}%0A`;
                    mensaje += `  ${item.descripcion}%0A`;
                    
                    // Agregar detalles de variables para combos
                    if (item.detallesVariables && item.detallesVariables.length > 0) {
                        item.detallesVariables.forEach(detalle => {
                            mensaje += `  ¬∑ ${detalle}%0A`;
                        });
                    }
                    
                    mensaje += `  x${item.cantidad} - $${item.precioTotal}%0A%0A`;
                } else {
                    // Formato para productos individuales
                    mensaje += `- ${item.nombre}`;
                    
                    // Agregar detalles de variables
                    if (item.detallesVariables && item.detallesVariables.length > 0) {
                        item.detallesVariables.forEach(detalle => {
                            mensaje += `%0A  ¬∑ ${detalle}`;
                        });
                    }
                    
                    mensaje += `%0A  x${item.cantidad} - $${item.precioTotal}%0A%0A`;
                }
            });
            
            const total = carrito.reduce((sum, item) => sum + item.precioTotal, 0);
            mensaje += `%0ATotal: $${total} MXN%0A%0A`;
            mensaje += `Direcci√≥n: ${direccionSeleccionada}%0A%0A`;
            mensaje += "Datos bancarios:%0A";
            mensaje += "Titular: Eric Daniel Guti√©rrez Arana%0A";
            mensaje += "CLABE: 012 261 01584933343 3 (BBVA)%0A%0A";
            mensaje += "¬°Gracias!";
            
            window.open(`https://wa.me/5215611649344?text=${mensaje}`, '_blank');
            
            // Limpiar carrito despu√©s de enviar
            carrito = [];
            guardarCarritoEnLocalStorage();
            actualizarCarrito();
            cerrarModalPago();
        }

        // Configurar panel administrativo
        function configurarPanelAdmin() {
            const selectProducto = document.getElementById('admin-producto');
            
            // Limpiar opciones existentes
            selectProducto.innerHTML = '<option value="">Seleccionar producto</option>';
            
            // Agregar todos los productos al selector
            for (const categoria in productos) {
                productos[categoria].forEach(producto => {
                    const option = document.createElement('option');
                    option.value = `${categoria}-${producto.id}`;
                    option.textContent = `${producto.nombre} - $${producto.precio}`;
                    selectProducto.appendChild(option);
                });
            }
            
            // Agregar evento para cargar precio actual al seleccionar producto
            selectProducto.addEventListener('change', function() {
                if (this.value) {
                    const [categoria, id] = this.value.split('-');
                    const producto = productos[categoria].find(p => p.id === parseInt(id));
                    document.getElementById('admin-precio').value = producto.precio;
                } else {
                    document.getElementById('admin-precio').value = '';
                }
            });
        }

        // Guardar cambios en el panel administrativo
        function guardarCambiosAdmin() {
            const selectProducto = document.getElementById('admin-producto');
            const inputPrecio = document.getElementById('admin-precio');
            
            if (!selectProducto.value || !inputPrecio.value) {
                alert('Por favor, selecciona un producto y ingresa un precio v√°lido.');
                return;
            }
            
            const [categoria, id] = selectProducto.value.split('-');
            const producto = productos[categoria].find(p => p.id === parseInt(id));
            
            if (producto) {
                producto.precio = parseInt(inputPrecio.value);
                alert(`Precio de ${producto.nombre} actualizado a $${producto.precio}`);
                
                // Recargar productos en la interfaz
                document.getElementById(`${categoria}-container`).innerHTML = '';
                productos[categoria].forEach(p => {
                    const elementoProducto = crearElementoProducto(p);
                    document.getElementById(`${categoria}-container`).appendChild(elementoProducto);
                });
            }
        }
    </script>

</body>
</html>
